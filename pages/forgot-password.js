import { Col, Row, Container, Form } from 'react-bootstrap'
import Head from 'next/head'
import styles from '../styles/Auth.module.scss'
import { useDispatch, useSelector } from 'react-redux'
import { changePassword } from '../redux/actions/auth'
import { useRouter } from 'next/router';
import Layout from '../components/Layout'
import { useEffect } from 'react'
import { Alert } from 'react-bootstrap'

const ForgotPassword = () => {

  const { auth } = useSelector(state => state)
  const dispatch = useDispatch()
  const router = useRouter()

  useEffect(() => {
    if (auth.successMsg) {
      router.push('/login-register')
    }
  }, [auth.successMsg])

  const onChangePassword = (e) => {
    e.preventDefault()
    const password = e.target.elements['password'].value
    const confirmPassword = e.target.elements['confirmPassword'].value
    const data = {
      otp: router.query.otp,
      password,
      confirmPassword
    }
    console.log(data)
    dispatch(changePassword(data))
  }
  return (
    <>
      <Layout>
        <Head>
          <title>The King | Change Password</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <div className={`${styles.profiles} `}>
          <div className="d-flex flex-column justify-content-center">
            <h1 className={`${styles.content} text-center mb-1 mt-5`}>My Account</h1>
            <h5 className={`${styles.content} text-center mb-5`}>Register and log in with your account to be able to shop at will</h5>
          </div>
        </div>
        <Container>
          <Row className='justify-content-center mt-5'>
            <Col xl={6} className='d-flex flex-column'>
              {auth.isErr && <Alert variant="danger" className='text-center'>{auth.errMsg[0]}<br />{auth.errMsg[1]}<br />{auth.errMsg[2]}</Alert>}
              {auth.successMsg && <Alert variant='success' className='text-center'>{auth.successMsg}</Alert>}
            </Col>
          </Row>
          <Row>
            <Col xl={3}></Col>
            <Col xl={6}>
              <Row className='mt-4 px-5'>
                <Col xl={12} className='mb-4'>
                  <div>
                    <h3>Forgot your Password?</h3>
                  </div>
                  <div>
                    <p>Donâ€™t worry! Just fill in your password and confirm password</p>
                  </div>
                </Col>
                <Form onSubmit={onChangePassword}>
                  <Col xl={12} className='mb-4'>
                    <div>
                      <input type='password' name='password' className='w-100 px-4 py-3' placeholder='Your password'></input>
                    </div>
                  </Col>
                  <Col xl={12} className='mb-4'>
                    <div>
                      <input type='password' name='confirmPassword' className='w-100 px-4 py-3' placeholder='Input your confirm password'></input>
                    </div>
                  </Col>
                  <Col xl={12} className='mb-5'>
                    <div>
                      <button type='submit' className={`${styles.button} px-4 py-3`}>Change Password</button>
                    </div>
                  </Col>
                </Form>
              </Row>
            </Col>
            <Col xl={3}></Col>
          </Row>
        </Container >
      </Layout>
    </>
  )
}

export default ForgotPassword